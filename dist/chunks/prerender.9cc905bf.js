import{l as e,d as t,v as r,B as n,i as o,t as s}from"../index.40fbee15.js";var a=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|^--/i,i=/[&<>"]/;function l(e){var t=String(e);return i.test(t)?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):t}var f=function(e,t){return String(e).replace(/(\n+)/g,"$1"+(t||"\t"))},c=function(e,t,r){return String(e).length>(t||40)||!r&&-1!==String(e).indexOf("\n")||-1!==String(e).indexOf("<")},p={};function u(e){var t="";for(var r in e){var n=e[r];null!=n&&""!==n&&(t&&(t+=" "),t+="-"==r[0]?r:p[r]||(p[r]=r.replace(/([A-Z])/g,"-$1").toLowerCase()),t+=": ",t+=n,"number"==typeof n&&!1===a.test(r)&&(t+="px"),t+=";")}return t||void 0}function _(e,t){for(var r in t)e[r]=t[r];return e}function g(e,t){return Array.isArray(t)?t.reduce(g,e):null!=t&&!1!==t&&e.push(t),e}var h={shallow:!0},d=[],v=/^(area|base|br|col|embed|hr|img|input|link|meta|param|source|track|wbr)$/,y=/[\s\n\\/='"\0<>]/,m=function(){};b.render=b;var x=[];function b(t,r,n){r=r||{},n=n||{};var o=e.__s;e.__s=!0;var s=w(t,r,n);return e.__c&&e.__c(t,x),x.length=0,e.__s=o,s}function w(r,n,o,s,a,i){if(null==r||"boolean"==typeof r)return"";if("object"!=typeof r)return l(r);var p=o.pretty,h=p&&"string"==typeof p?p:"\t";if(Array.isArray(r)){for(var x="",b=0;b<r.length;b++)p&&b>0&&(x+="\n"),x+=w(r[b],n,o,s,a,i);return x}var S,O=r.type,k=r.props,$=!1;if("function"==typeof O){if($=!0,!o.shallow||!s&&!1!==o.renderRootComponent){if(O===t){var j=[];return g(j,r.props.children),w(j,n,o,!1!==o.shallowHighOrder,a,i)}var C,E=r.__c={__v:r,context:n,props:r.props,setState:m,forceUpdate:m,__h:[]};if(e.__b&&e.__b(r),e.__r&&e.__r(r),O.prototype&&"function"==typeof O.prototype.render){var R=O.contextType,A=R&&n[R.__c],D=null!=R?A?A.props.value:R.__:n;(E=r.__c=new O(k,D)).__v=r,E._dirty=E.__d=!0,E.props=k,null==E.state&&(E.state={}),null==E._nextState&&null==E.__s&&(E._nextState=E.__s=E.state),E.context=D,O.getDerivedStateFromProps?E.state=_(_({},E.state),O.getDerivedStateFromProps(E.props,E.state)):E.componentWillMount&&(E.componentWillMount(),E.state=E._nextState!==E.state?E._nextState:E.__s!==E.state?E.__s:E.state),C=E.render(E.props,E.state,E.context)}else{var H=O.contextType,M=H&&n[H.__c];C=O.call(r.__c,k,null!=H?M?M.props.value:H.__:n)}return E.getChildContext&&(n=_(_({},n),E.getChildContext())),e.diffed&&e.diffed(r),w(C,n,o,!1!==o.shallowHighOrder,a,i)}O=(S=O).displayName||S!==Function&&S.name||function(e){var t=(Function.prototype.toString.call(e).match(/^\s*function\s+([^( ]+)/)||"")[1];if(!t){for(var r=-1,n=d.length;n--;)if(d[n]===e){r=n;break}r<0&&(r=d.push(e)-1),t="UnnamedComponent"+r}return t}(S)}var P,T,F="<"+O;if(k){var W=Object.keys(k);o&&!0===o.sortAttributes&&W.sort();for(var L=0;L<W.length;L++){var N=W[L],I=k[N];if("children"!==N){if(!y.test(N)&&(o&&o.allAttributes||"key"!==N&&"ref"!==N&&"__self"!==N&&"__source"!==N&&"defaultValue"!==N)){if("className"===N){if(k.class)continue;N="class"}else a&&N.match(/^xlink:?./)&&(N=N.toLowerCase().replace(/^xlink:?/,"xlink:"));if("htmlFor"===N){if(k.for)continue;N="for"}"style"===N&&I&&"object"==typeof I&&(I=u(I)),"a"===N[0]&&"r"===N[1]&&"boolean"==typeof I&&(I=String(I));var U=o.attributeHook&&o.attributeHook(N,I,n,o,$);if(U||""===U)F+=U;else if("dangerouslySetInnerHTML"===N)T=I&&I.__html;else if("textarea"===O&&"value"===N)P=I;else if((I||0===I||""===I)&&"function"!=typeof I){if(!(!0!==I&&""!==I||(I=N,o&&o.xml))){F+=" "+N;continue}if("value"===N){if("select"===O){i=I;continue}"option"===O&&i==I&&(F+=" selected")}F+=" "+N+'="'+l(I)+'"'}}}else P=I}}if(p){var q=F.replace(/\n\s*/," ");q===F||~q.indexOf("\n")?p&&~F.indexOf("\n")&&(F+="\n"):F=q}if(F+=">",y.test(O))throw new Error(O+" is not a valid HTML tag name in "+F);var z,G=v.test(O)||o.voidElements&&o.voidElements.test(O),V=[];if(T)p&&c(T)&&(T="\n"+h+f(T,h)),F+=T;else if(null!=P&&g(z=[],P).length){for(var Z=p&&~F.indexOf("\n"),B=!1,J=0;J<z.length;J++){var K=z[J];if(null!=K&&!1!==K){var Q=w(K,n,o,!0,"svg"===O||"foreignObject"!==O&&a,i);if(p&&!Z&&c(Q)&&(Z=!0),Q)if(p){var X=Q.length>0&&"<"!=Q[0];B&&X?V[V.length-1]+=Q:V.push(Q),B=X}else V.push(Q)}}if(p&&Z)for(var Y=V.length;Y--;)V[Y]="\n"+h+f(V[Y],h)}if(V.length||T)F+=V.join("");else if(o&&o.xml)return F.substring(0,F.length-1)+" />";return!G||z||T?(p&&~F.indexOf("\n")&&(F+="\n"),F+="</"+O+">"):F=F.replace(/>$/," />"),F}let S;b.shallowRender=function(e,t){return b(e,t,h)};const O=e.vnode;e.vnode=e=>{O&&O(e),S&&S(e)};const k=(()=>{const e=(()=>{const e=[];let t=[];const r=(e,r)=>t[r]=e(t[r]);return{init:t=>r(t,e.push(t)-1),reset:(n=[])=>([n,t]=[t,n],e.forEach(r),n)}})();let t;return e.init(((e=[])=>t=e)),Object.defineProperties({get target(){return[...t]},insert:(e,r)=>t.splice(r,0,e)},Object.getOwnPropertyDescriptors(e))})();o(!1,k);const $=async(e,t,o)=>{const a=`WMR TWIND PRERENDER [${e}]:\n`;if(console.log(`${a}stylesheet reset and Preact WMR SSG / static SSR...`),k.reset(),!1===s.preflight&&k.target.length){const e=`${a}no preflight but stylesheet is not empty after reset?!`;throw console.log(e),new Error(e)}const i=await async function(e,t){const o=(t=t||{}).maxDepth||10,s=t.props;let a=0;"function"==typeof e?e=r(e,s):s&&(e=n(e,s));const i=()=>{if(!(++a>o))try{return b(e)}catch(t){if(t&&t.then)return t.then(i);throw t}};let l=new Set;S=({type:e,props:t})=>{"a"!==e||!t||!t.href||t.target&&"_self"!==t.target||l.add(t.href)};try{return{html:await i(),links:l}}finally{S=null}}(t,o);if(!k.target.length){const e=`${a}stylesheet is empty after prerender?!\n${i.html}`;console.log(e)}return{...i,cssTextContent:k.target.join("\n"),cssId:"__twind"}};export{$ as preactWmrPrerenderForTwind};