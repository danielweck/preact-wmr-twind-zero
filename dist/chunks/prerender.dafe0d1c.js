import{l as e,d as t,v as n,B as r,a as o,i as a}from"../index.7157787c.js";var l=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|^--/i,i=/[&<>"]/;function s(e){var t=String(e);return i.test(t)?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):t}var f=function(e,t){return String(e).replace(/(\n+)/g,"$1"+(t||"\t"))},c=function(e,t,n){return String(e).length>(t||40)||!n&&-1!==String(e).indexOf("\n")||-1!==String(e).indexOf("<")},u={};function p(e){var t="";for(var n in e){var r=e[n];null!=r&&""!==r&&(t&&(t+=" "),t+="-"==n[0]?n:u[n]||(u[n]=n.replace(/([A-Z])/g,"-$1").toLowerCase()),t+=": ",t+=r,"number"==typeof r&&!1===l.test(n)&&(t+="px"),t+=";")}return t||void 0}function _(e,t){for(var n in t)e[n]=t[n];return e}function g(e,t){return Array.isArray(t)?t.reduce(g,e):null!=t&&!1!==t&&e.push(t),e}var h={shallow:!0},d=[],v=/^(area|base|br|col|embed|hr|img|input|link|meta|param|source|track|wbr)$/,y=/[\s\n\\/='"\0<>]/,m=function(){};b.render=b;var x=[];function b(t,n,r){n=n||{},r=r||{};var o=e.__s;e.__s=!0;var a=w(t,n,r);return e.__c&&e.__c(t,x),x.length=0,e.__s=o,a}function w(n,r,o,a,l,i){if(null==n||"boolean"==typeof n)return"";if("object"!=typeof n)return s(n);var u=o.pretty,h=u&&"string"==typeof u?u:"\t";if(Array.isArray(n)){for(var x="",b=0;b<n.length;b++)u&&b>0&&(x+="\n"),x+=w(n[b],r,o,a,l,i);return x}var S,k=n.type,O=n.props,$=!1;if("function"==typeof k){if($=!0,!o.shallow||!a&&!1!==o.renderRootComponent){if(k===t){var C=[];return g(C,n.props.children),w(C,r,o,!1!==o.shallowHighOrder,l,i)}var R,j=n.__c={__v:n,context:r,props:n.props,setState:m,forceUpdate:m,__h:[]};if(e.__b&&e.__b(n),e.__r&&e.__r(n),k.prototype&&"function"==typeof k.prototype.render){var A=k.contextType,E=A&&r[A.__c],H=null!=A?E?E.props.value:A.__:r;(j=n.__c=new k(O,H)).__v=n,j._dirty=j.__d=!0,j.props=O,null==j.state&&(j.state={}),null==j._nextState&&null==j.__s&&(j._nextState=j.__s=j.state),j.context=H,k.getDerivedStateFromProps?j.state=_(_({},j.state),k.getDerivedStateFromProps(j.props,j.state)):j.componentWillMount&&(j.componentWillMount(),j.state=j._nextState!==j.state?j._nextState:j.__s!==j.state?j.__s:j.state),R=j.render(j.props,j.state,j.context)}else{var M=k.contextType,T=M&&r[M.__c];R=k.call(n.__c,O,null!=M?T?T.props.value:M.__:r)}return j.getChildContext&&(r=_(_({},r),j.getChildContext())),e.diffed&&e.diffed(n),w(R,r,o,!1!==o.shallowHighOrder,l,i)}k=(S=k).displayName||S!==Function&&S.name||function(e){var t=(Function.prototype.toString.call(e).match(/^\s*function\s+([^( ]+)/)||"")[1];if(!t){for(var n=-1,r=d.length;r--;)if(d[r]===e){n=r;break}n<0&&(n=d.push(e)-1),t="UnnamedComponent"+n}return t}(S)}var D,F,W="<"+k;if(O){var L=Object.keys(O);o&&!0===o.sortAttributes&&L.sort();for(var N=0;N<L.length;N++){var P=L[N],I=O[P];if("children"!==P){if(!y.test(P)&&(o&&o.allAttributes||"key"!==P&&"ref"!==P&&"__self"!==P&&"__source"!==P&&"defaultValue"!==P)){if("className"===P){if(O.class)continue;P="class"}else l&&P.match(/^xlink:?./)&&(P=P.toLowerCase().replace(/^xlink:?/,"xlink:"));if("htmlFor"===P){if(O.for)continue;P="for"}"style"===P&&I&&"object"==typeof I&&(I=p(I)),"a"===P[0]&&"r"===P[1]&&"boolean"==typeof I&&(I=String(I));var U=o.attributeHook&&o.attributeHook(P,I,r,o,$);if(U||""===U)W+=U;else if("dangerouslySetInnerHTML"===P)F=I&&I.__html;else if("textarea"===k&&"value"===P)D=I;else if((I||0===I||""===I)&&"function"!=typeof I){if(!(!0!==I&&""!==I||(I=P,o&&o.xml))){W+=" "+P;continue}if("value"===P){if("select"===k){i=I;continue}"option"===k&&i==I&&(W+=" selected")}W+=" "+P+'="'+s(I)+'"'}}}else D=I}}if(u){var q=W.replace(/\n\s*/," ");q===W||~q.indexOf("\n")?u&&~W.indexOf("\n")&&(W+="\n"):W=q}if(W+=">",y.test(k))throw new Error(k+" is not a valid HTML tag name in "+W);var z,G=v.test(k)||o.voidElements&&o.voidElements.test(k),V=[];if(F)u&&c(F)&&(F="\n"+h+f(F,h)),W+=F;else if(null!=D&&g(z=[],D).length){for(var Z=u&&~W.indexOf("\n"),B=!1,J=0;J<z.length;J++){var K=z[J];if(null!=K&&!1!==K){var Q=w(K,r,o,!0,"svg"===k||"foreignObject"!==k&&l,i);if(u&&!Z&&c(Q)&&(Z=!0),Q)if(u){var X=Q.length>0&&"<"!=Q[0];B&&X?V[V.length-1]+=Q:V.push(Q),B=X}else V.push(Q)}}if(u&&Z)for(var Y=V.length;Y--;)V[Y]="\n"+h+f(V[Y],h)}if(V.length||F)W+=V.join("");else if(o&&o.xml)return W.substring(0,W.length-1)+" />";return!G||z||F?(u&&~W.indexOf("\n")&&(W+="\n"),W+="</"+k+">"):W=W.replace(/>$/," />"),W}let S;b.shallowRender=function(e,t){return b(e,t,h)};const k=e.vnode;e.vnode=e=>{k&&k(e),S&&S(e)};const O=o(),$=a(!1,O),C=async(e,t,o)=>{const a=`WMR TWIND PRERENDER [${e}]:\n`;if(console.log(`${a}stylesheet reset and Preact WMR SSG / static SSR...`),$?$.clear():O.clear(),O.target.length){const e=`${a}no preflight but stylesheet is not empty after reset?!`;throw console.log(e),new Error(e)}const l=await async function(e,t){const o=(t=t||{}).maxDepth||10,a=t.props;let l=0;"function"==typeof e?e=n(e,a):a&&(e=r(e,a));const i=()=>{if(!(++l>o))try{return b(e)}catch(t){if(t&&t.then)return t.then(i);throw t}};let s=new Set;S=({type:e,props:t})=>{"a"!==e||!t||!t.href||t.target&&"_self"!==t.target||s.add(t.href)};try{return{html:await i(),links:s}}finally{S=null}}(t,o);if(!O.target.length){const e=`${a}stylesheet is empty after prerender?!\n${l.html}`;console.log(e)}return{...l,cssTextContent:O.target.join("\n"),cssId:"__twind"}};export{C as preactWmrPrerenderForTwind};