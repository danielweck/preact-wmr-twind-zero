import{l as t,d as e,v as r,B as n,i as o,t as s}from"../index.54b92c5f.js";var a=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|^--/i,i=/[&<>"]/;function l(t){var e=String(t);return i.test(e)?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):e}var f=function(t,e){return String(t).replace(/(\n+)/g,"$1"+(e||"\t"))},c=function(t,e,r){return String(t).length>(e||40)||!r&&-1!==String(t).indexOf("\n")||-1!==String(t).indexOf("<")},p={};function u(t){var e="";for(var r in t){var n=t[r];null!=n&&""!==n&&(e&&(e+=" "),e+="-"==r[0]?r:p[r]||(p[r]=r.replace(/([A-Z])/g,"-$1").toLowerCase()),e+=": ",e+=n,"number"==typeof n&&!1===a.test(r)&&(e+="px"),e+=";")}return e||void 0}function _(t,e){for(var r in e)t[r]=e[r];return t}function g(t,e){return Array.isArray(e)?e.reduce(g,t):null!=e&&!1!==e&&t.push(e),t}var h={shallow:!0},d=[],v=/^(area|base|br|col|embed|hr|img|input|link|meta|param|source|track|wbr)$/,y=/[\s\n\\/='"\0<>]/,m=function(){};b.render=b;var x=[];function b(e,r,n){r=r||{},n=n||{};var o=t.__s;t.__s=!0;var s=w(e,r,n);return t.__c&&t.__c(e,x),x.length=0,t.__s=o,s}function w(r,n,o,s,a,i){if(null==r||"boolean"==typeof r)return"";if("object"!=typeof r)return l(r);var p=o.pretty,h=p&&"string"==typeof p?p:"\t";if(Array.isArray(r)){for(var x="",b=0;b<r.length;b++)p&&b>0&&(x+="\n"),x+=w(r[b],n,o,s,a,i);return x}var S,O=r.type,k=r.props,$=!1;if("function"==typeof O){if($=!0,!o.shallow||!s&&!1!==o.renderRootComponent){if(O===e){var j=[];return g(j,r.props.children),w(j,n,o,!1!==o.shallowHighOrder,a,i)}var C,E=r.__c={__v:r,context:n,props:r.props,setState:m,forceUpdate:m,__h:[]};if(t.__b&&t.__b(r),t.__r&&t.__r(r),O.prototype&&"function"==typeof O.prototype.render){var R=O.contextType,A=R&&n[R.__c],D=null!=R?A?A.props.value:R.__:n;(E=r.__c=new O(k,D)).__v=r,E._dirty=E.__d=!0,E.props=k,null==E.state&&(E.state={}),null==E._nextState&&null==E.__s&&(E._nextState=E.__s=E.state),E.context=D,O.getDerivedStateFromProps?E.state=_(_({},E.state),O.getDerivedStateFromProps(E.props,E.state)):E.componentWillMount&&(E.componentWillMount(),E.state=E._nextState!==E.state?E._nextState:E.__s!==E.state?E.__s:E.state),C=E.render(E.props,E.state,E.context)}else{var H=O.contextType,M=H&&n[H.__c];C=O.call(r.__c,k,null!=H?M?M.props.value:H.__:n)}return E.getChildContext&&(n=_(_({},n),E.getChildContext())),t.diffed&&t.diffed(r),w(C,n,o,!1!==o.shallowHighOrder,a,i)}O=(S=O).displayName||S!==Function&&S.name||function(t){var e=(Function.prototype.toString.call(t).match(/^\s*function\s+([^( ]+)/)||"")[1];if(!e){for(var r=-1,n=d.length;n--;)if(d[n]===t){r=n;break}r<0&&(r=d.push(t)-1),e="UnnamedComponent"+r}return e}(S)}var P,T,F="<"+O;if(k){var W=Object.keys(k);o&&!0===o.sortAttributes&&W.sort();for(var L=0;L<W.length;L++){var N=W[L],I=k[N];if("children"!==N){if(!y.test(N)&&(o&&o.allAttributes||"key"!==N&&"ref"!==N&&"__self"!==N&&"__source"!==N&&"defaultValue"!==N)){if("className"===N){if(k.class)continue;N="class"}else a&&N.match(/^xlink:?./)&&(N=N.toLowerCase().replace(/^xlink:?/,"xlink:"));if("htmlFor"===N){if(k.for)continue;N="for"}"style"===N&&I&&"object"==typeof I&&(I=u(I)),"a"===N[0]&&"r"===N[1]&&"boolean"==typeof I&&(I=String(I));var U=o.attributeHook&&o.attributeHook(N,I,n,o,$);if(U||""===U)F+=U;else if("dangerouslySetInnerHTML"===N)T=I&&I.__html;else if("textarea"===O&&"value"===N)P=I;else if((I||0===I||""===I)&&"function"!=typeof I){if(!(!0!==I&&""!==I||(I=N,o&&o.xml))){F+=" "+N;continue}if("value"===N){if("select"===O){i=I;continue}"option"===O&&i==I&&(F+=" selected")}F+=" "+N+'="'+l(I)+'"'}}}else P=I}}if(p){var q=F.replace(/\n\s*/," ");q===F||~q.indexOf("\n")?p&&~F.indexOf("\n")&&(F+="\n"):F=q}if(F+=">",y.test(O))throw new Error(O+" is not a valid HTML tag name in "+F);var z,G=v.test(O)||o.voidElements&&o.voidElements.test(O),V=[];if(T)p&&c(T)&&(T="\n"+h+f(T,h)),F+=T;else if(null!=P&&g(z=[],P).length){for(var Z=p&&~F.indexOf("\n"),B=!1,J=0;J<z.length;J++){var K=z[J];if(null!=K&&!1!==K){var Q=w(K,n,o,!0,"svg"===O||"foreignObject"!==O&&a,i);if(p&&!Z&&c(Q)&&(Z=!0),Q)if(p){var X=Q.length>0&&"<"!=Q[0];B&&X?V[V.length-1]+=Q:V.push(Q),B=X}else V.push(Q)}}if(p&&Z)for(var Y=V.length;Y--;)V[Y]="\n"+h+f(V[Y],h)}if(V.length||T)F+=V.join("");else if(o&&o.xml)return F.substring(0,F.length-1)+" />";return!G||z||T?(p&&~F.indexOf("\n")&&(F+="\n"),F+="</"+O+">"):F=F.replace(/>$/," />"),F}let S;b.shallowRender=function(t,e){return b(t,e,h)};const O=t.vnode;t.vnode=t=>{O&&O(t),S&&S(t)};const k=(()=>{const t=(()=>{const t=[];let e=[];const r=(t,r)=>e[r]=t(e[r]);return{init:e=>r(e,t.push(e)-1),reset:(n=[])=>([n,e]=[e,n],t.forEach(r),n)}})();let e;return t.init(((t=[])=>e=t)),Object.defineProperties({get target(){return[...e]},insert:(t,r)=>e.splice(r,0,t)},Object.getOwnPropertyDescriptors(t))})();o(!1,k);const $=async(t,e,o)=>{const a=`WMR TWIND PRERENDER [${t}]:\n`;if(console.log(`${a}stylesheet reset and Preact WMR SSG / static SSR...`),k.reset(),!1===s.preflight&&k.target.length){const t=`${a}no preflight but stylesheet is not empty after reset?!`;throw console.log(t),new Error(t)}const i=await async function(t,e){const o=(e=e||{}).maxDepth||10,s=e.props;let a=0;"function"==typeof t?t=r(t,s):s&&(t=n(t,s));const i=()=>{if(!(++a>o))try{return b(t)}catch(e){if(e&&e.then)return e.then(i);throw e}};let l=new Set;S=({type:t,props:e})=>{"a"!==t||!e||!e.href||e.target&&"_self"!==e.target||l.add(e.href)};try{return{html:await i(),links:l}}finally{S=null}}(e,o);if(!k.target.length){const t=`${a}stylesheet is empty after prerender?!\n${i.html}`;console.log(t)}return{...i,cssTextContent:k.target.join("\n"),cssId:"__twind"}};export{$ as preactWmrPrerenderForTwind};